<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yameokja.mc.IUserMypageDAO">

<!-- 닉네임 포인트 키워드 -->
<select id="usermp_npk" resultType="com.yameokja.mc.UserMypageDTO">
	SELECT DISTINCT UU.USER_ID AS USERID, UU.USER_NICKNAME AS NICKNAME, SUM(PL.POINT) OVER(ORDER BY UU.USER_NUM) AS POINT
	FROM USING_USER UU JOIN USER_LIST UL
	ON UU.USER_NUM = UL.USER_NUM
	JOIN POINT_HISTORY PH
	ON UL.USER_NUM = PH.USER_NUM
	JOIN POINT_LABEL PL
	ON PH.POINT_LABEL_NUM = PL.POINT_LABEL_NUM
	WHERE UU.USER_NUM = 1
</select>

<!-- 사용자 마이페이지 비교했던 가게 목록 -->
<select id="usermp_risonstlist" resultType="com.yameokja.mc.UserMypageDTO">
	SELECT SP.PHOTO_LINK AS CBLPHOTO, IA.ST_NAME AS CBLSTNAME, CB.REG_DATE AS CBREGDATE
	FROM COMPARED_BOX CB JOIN ST_LIST SL
	ON CB.ST_NUM = SL.ST_NUM
	JOIN ST_PHOTO SP
	ON SL.ST_NUM = SP.ST_NUM
	JOIN IN_PROCESS IP
	ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
	JOIN IN_APPLY IA
	ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
	WHERE CB.USER_NUM = 1
</select>

<!-- 사용자 마이페이지 작성한 리뷰목록 -->
<select id="usermp_rvlist" resultType="com.yameokja.mc.UserMypageDTO">
	SELECT RB.RV_NUM AS RVNUM, IA.ST_NAME AS RVSTNAME, RB.RV_CONTENT AS RVCONTENT, RB.REG_DATE AS RBREGDATE
	FROM RV_BOX RB JOIN ST_LIST SL
	ON RB.ST_NUM = SL.ST_NUM
	JOIN IN_PROCESS IP
	ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
	JOIN IN_APPLY IA
	ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
	WHERE RB.USER_NUM = 1
</select>

<!-- 사용자 마이페이지 찜 목록 -->
<select id="usermp_likelist" resultType="com.yameokja.mc.UserMypageDTO">
	SELECT SP.PHOTO_LINK AS JJIMPHOTO, IA.ST_NAME AS JJIMSTNAME 
	FROM LIKE_BOX LB JOIN ST_LIST SL
	ON LB.ST_NUM = SL.ST_NUM
	JOIN ST_PHOTO SP
	ON SL.ST_NUM = SP.ST_NUM
	JOIN IN_PROCESS IP
	ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
	JOIN IN_APPLY IA
	ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
	WHERE LB.USER_NUM = 1
</select>

<!-- 비교함 -->
<select id="usermp_compare_box" resultType="com.yameokja.mc.UserMypageDTO">
	SELECT SP.PHOTO_LINK AS CBPHOTO, IA.ST_NAME AS CBSTNAME 
	FROM COMPARING_BOX CB JOIN ST_LIST SL
	ON CB.ST_NUM = SL.ST_NUM
	JOIN IN_PROCESS IP
	ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
	JOIN IN_APPLY IA
	ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
	JOIN ST_PHOTO SP
	ON SP.ST_NUM = SL.ST_NUM
	WHERE CB.USER_NUM = 1
</select>

</mapper>