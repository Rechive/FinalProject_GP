<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yameokja.controller.IUserMypageDAO">

<!-- 닉네임 포인트 키워드 -->
<select id="usermp_npk" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT DISTINCT UU.USER_ID AS USERID, UU.USER_NICKNAME AS NICKNAME, SUM(PL.POINT) OVER(ORDER BY UU.USER_NUM) AS POINT
	FROM USING_USER UU JOIN USER_LIST UL
	ON UU.USER_NUM = UL.USER_NUM
	JOIN POINT_HISTORY PH
	ON UL.USER_NUM = PH.USER_NUM
	JOIN POINT_LABEL PL
	ON PH.POINT_LABEL_NUM = PL.POINT_LABEL_NUM
	WHERE UU.USER_NUM = 1
</select>

<!-- 닉네임 아이디 -->
<select id="usermp_ni" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT USER_ID 	AS USERID, USER_NICKNAME AS NICKNAME
	FROM USER_VIEW
	WHERE USER_ID = 1
</select>

<!-- 키워드 -->
<select id="usermp_ukeyword" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT TL.TASTE_KEYWORD AS UKEYWORD
	FROM USER_TASTE UT JOIN TASTE_LABEL TL
	ON UT.TASTE_NUM = TL.TASTE_NUM
	WHERE UT.USER_NUM = 1
</select>

<!-- 사용자 마이페이지 비교했던 가게 목록 -->
<select id="usermp_risonstlist" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT SP.PHOTO_LINK AS CBLPHOTO, IA.ST_NAME AS CBLSTNAME, CB.REG_DATE AS CBREGDATE
	FROM COMPARED_BOX CB JOIN ST_LIST SL
	ON CB.ST_NUM = SL.ST_NUM
	JOIN ST_PHOTO SP
	ON SL.ST_NUM = SP.ST_NUM
	JOIN IN_PROCESS IP
	ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
	JOIN IN_APPLY IA
	ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
	WHERE CB.USER_NUM = 1
</select>

<!-- 사용자 마이페이지 작성한 리뷰목록 -->
<select id="usermp_rvlist" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT RB.RV_NUM AS RVNUM, IA.ST_NAME AS RVSTNAME, RB.RV_CONTENT AS RVCONTENT, RB.REG_DATE AS RBREGDATE
	FROM RV_BOX RB JOIN ST_LIST SL
	ON RB.ST_NUM = SL.ST_NUM
	JOIN IN_PROCESS IP
	ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
	JOIN IN_APPLY IA
	ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
	WHERE RB.USER_NUM = 1
</select>

<!-- 사용자 마이페이지 찜 목록 -->
<select id="usermp_likelist" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT SP.PHOTO_LINK AS JJIMPHOTO, IA.ST_NAME AS JJIMSTNAME 
	FROM LIKE_BOX LB JOIN ST_LIST SL
	ON LB.ST_NUM = SL.ST_NUM
	JOIN ST_PHOTO SP
	ON SL.ST_NUM = SP.ST_NUM
	JOIN IN_PROCESS IP
	ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
	JOIN IN_APPLY IA
	ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
	WHERE LB.USER_NUM = 1
</select>

<!-- 비교함 -->
<select id="usermp_compare_box" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT SP.PHOTO_LINK AS CBPHOTO, IA.ST_NAME AS CBSTNAME 
	FROM COMPARING_BOX CB JOIN ST_LIST SL
	ON CB.ST_NUM = SL.ST_NUM
	JOIN IN_PROCESS IP
	ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
	JOIN IN_APPLY IA
	ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
	JOIN ST_PHOTO SP
	ON SP.ST_NUM = SL.ST_NUM
	WHERE CB.USER_NUM = 1
</select>

<!-- 포인트 -->
<select id="usermp_point" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT CASE WHEN (EXTRACT(MONTH FROM SYSDATE) BETWEEN 1 AND 6) THEN (SELECT POINT_SUM FROM FIRST_HALF_GRADE)
	            ELSE (SELECT POINT_SUM FROM SECOND_HALF_GRADE)
	            END AS POINT
	FROM FIRST_HALF_GRADE FHG JOIN SECOND_HALF_GRADE SHG
	ON FHG.USER_NUM = SHG.USER_NUM
</select>

<!-- 등급 -->
<select id="usermp_grade" resultType="com.yameokja.controller.UserMypageDTO">
	SELECT CASE WHEN (EXTRACT(MONTH FROM SYSDATE) BETWEEN 1 AND 6) THEN (SELECT USER_GRADE FROM FIRST_HALF_GRADE)
	            ELSE (SELECT USER_GRADE FROM SECOND_HALF_GRADE)
	            END AS GRADE
	FROM FIRST_HALF_GRADE FHG JOIN SECOND_HALF_GRADE SHG
	ON FHG.USER_NUM = SHG.USER_NUM
</select>

</mapper>