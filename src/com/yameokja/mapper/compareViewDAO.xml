<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yameokja.mc.compareViewDAO">

	<!-- 가게 이름, 주소, 카테고리 -->
	<select id="nameLoCat" resultType="com.yameokja.mc.compareViewDTO">
		SELECT IA.ST_NAME ST_NAME, FL.FOOD_NAME AS FOOD_NAME, IA.ST_LOCATION AS ST_LOCATION
		FROM ST_FOOD SF
		JOIN ST_LIST SL ON SF.ST_NUM = SL.ST_NUM
		JOIN FOOD_LABEL FL ON SF.FOOD_NUM = FL.FOOD_NUM
		JOIN IN_PROCESS IP ON SL.IN_PROCESS_NUM = IP.IN_PROCESS_NUM
		JOIN IN_APPLY IA ON IP.IN_APPLY_NUM = IA.IN_APPLY_NUM
		WHERE SL.ST_NUM = {st_num}
	</select>
	
	
	<!-- 주소 -->
 	<select id="lo" resultType="com.yameokja.mc.compareViewDTO"> 
 		SELECT ST_LOCATION
 		FROM IN_APPLY
		LEFT JOIN IN_PROCESS
		ON IN_APPLY.IN_APPLY_NUM = IN_PROCESS.IN_APPLY_NUM
		LEFT JOIN ST_LIST
		ON IN_PROCESS.IN_PROCESS_NUM = ST_LIST.IN_PROCESS_NUM
		WHERE ST_LIST.ST_NUM = #{st_num}
 	</select>
	
	<!-- 별점 평균 -->
	 <select id="creviewScore" resultType="java.lang.Double"> 
 		SELECT NVL(ROUND(AVG(STAR_SCORE), 2), 0) AS STAR_SCORE
		FROM ST_LIST
		LEFT JOIN RV_BOX 
		ON ST_LIST.ST_NUM = RV_BOX.ST_NUM
		WHERE ST_LIST.ST_NUM = #{st_num}
 	</select>
 	
 	
 	<!-- 리뷰 수 -->
 	<select id="creviewNum" resultType="java.lang.Integer"> 
 		SELECT NVL(COUNT(RV_BOX.RV_NUM), 0) AS REVIEW_COUNT
		FROM ST_LIST
		LEFT JOIN  RV_BOX
		ON ST_LIST.ST_NUM = RV_BOX.ST_NUM
		WHERE ST_LIST.ST_NUM = #{st_num}
 	</select>
	
	
	<!-- 영업시간  -->
 	<select id="openClose" resultType="com.yameokja.mc.compareViewDTO">
	 	SELECT SL.ST_NUM AS ST_NUM, OC.DAY_NUM AS DAY_NUM, WDL.DAY_NAME AS DAY_NAME
			, OC.START_TIME AS START_TIME, OC.END_TIME AS END_TIME
		FROM ST_OPENCLOSE OC
		JOIN ST_LIST SL ON OC.ST_NUM = SL.ST_NUM
		JOIN WEEKDAY_LABEL WDL ON OC.DAY_NUM = WDL.DAY_NUM
		WHERE SL.ST_NUM = #{st_num}
		ORDER BY DAY_NUM
 	</select>
 	
 	
 	<!-- 메뉴 및 가격 가져오기-->
 	<select id="menuLists" resultType="com.yameokja.mc.compareViewDTO">
 		SELECT MENU_NAME, PRICE, IMAGE_LINK
		FROM MENU
		LEFT JOIN ST_LIST SL ON SL.ST_NUM = MENU.ST_NUM
		WHERE SL.ST_NUM = #{st_num}
 	</select> 	
 	
 	
 	<!-- 기타사항 / 결제수단, 설명, 이메일, 가게 최대 인원수 -->
 	<select id="others" resultType="com.yameokja.mc.compareViewDTO">
		SELECT ST_EXPLAIN
		FROM STORE_OTHERS
		WHERE ST_NUM = #{st_num}
 	</select>
	
	
</mapper>